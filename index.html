<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>APCA + WCAG 2 Contrast Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description"
        content="Compare APCA and WCAG 2.x contrast, see previews, and explore suggestions for foreground, background, and focus colors.">
  <meta name="color-scheme" content="light dark">
  <link rel="stylesheet" href="styles.css">
  <script>
const LIMIT = 55;
const bskyPostId = document.querySelector("[data-bsky-post-id]").dataset.bskyPostId;
const container = document.querySelector("[data-bsky-container]");
const likesContainer = document.querySelector("[data-bsky-likes]");
const likesCount = document.querySelector("[data-bsky-likes-count]");
const myDid = "did:plc:rbc5qboqtdfylqz2aylrdaon";
const bskyAPI = "https://public.api.bsky.app/xrpc/";
const getLikesURL = `${bskyAPI}app.bsky.feed.getLikes?limit=${LIMIT}&uri=`;
const getPostURL = `${bskyAPI}app.bsky.feed.getPosts?uris=`;

function drawHowManyMore(postLikesCount, likesActorLength) {
  if (postLikesCount > LIMIT) {
    const likesMore = document.createElement("li");
    likesMore.classList.add("post__like");
    likesMore.classList.add("post__like--howManyMore");
    likesMore.innerText = `+${postLikesCount - likesActorLength}`;
    likesContainer.appendChild(likesMore);
  }
}

function drawLikes(likesActors, postLikesCount) {
  for (const like of likesActors) {
    const likeEl = document.createElement("li");
    likeEl.classList.add("post__like");

    if (like.actor.avatar !== undefined) {
      likeEl.innerHTML = `
      <img class="post__like__avatar" src="${like.actor.avatar.replace("avatar", "avatar_thumbnail")}" alt="${
        like.actor.displayName
      }" />`;
    } else {
      likeEl.classList.add("post__like--placeholder");
      likeEl.innerHTML = `
        <span aria-label="${like.actor.displayName}">@</span>
      `;
    }
    likesContainer.appendChild(likeEl);
  }

  drawHowManyMore(postLikesCount, likesActors.length);
}

if (bskyPostId !== "null") {
  const postUri = `at://${myDid}/app.bsky.feed.post/${bskyPostId}`;
  try {
    const bskyPost = await fetch(getPostURL + postUri);
    const bskyPostLikes = await fetch(getLikesURL + postUri);
    const postData = await bskyPost.json();
    const likesData = await bskyPostLikes.json();

    const totalLikesCount = postData.posts[0].likeCount;

    if (likesData.likes.length > 0) {
      likesCount.textContent = totalLikesCount;
      drawLikes(likesData.likes, totalLikesCount);
    }
  } catch (error) {
    container.remove();
  }
}
	  
  </script>
</head>
<body>
  <a class="skip-link" href="#fgText">Skip to main</a>
  <main id="main" class="page" data-sim="normal">
    <header class="page-header">
      <h1>APCA + WCAG 2 Contrast Checker</h1>
      <div class="theme-toggle" aria-label="Color theme">
        <button type="button" class="theme-toggle-button" data-theme-choice="system">System</button>
        <button type="button" class="theme-toggle-button" data-theme-choice="light">Light</button>
        <button type="button" class="theme-toggle-button" data-theme-choice="dark">Dark</button>
      </div>
      <p>
        Enter colors using any modern CSS color format supported by your browser. This tool evaluates <a href="https://www.w3.org/TR/WCAG22/#contrast-minimum">WCAG&nbsp;2.x</a> & <a href="https://apcacontrast.com/">APCA Lc</a> contrast ratios.
      </p>
    </header>

    <section class="panel" aria-labelledby="inputs-heading">
      <h2 id="inputs-heading">Inputs</h2>

      <div class="input-row">
        <div class="color-group">
          <h3>Foreground</h3>
          <label class="field">
            <span>Color value</span>
            <input id="fgText" class="text-input" type="text" value="#45ad7f" autocomplete="off" aria-describedby="colorExamples">
          </label>
          <label class="field">
            <div class="picker-row">
              <div class="mini-group">
                <div class="mini-label">Picker</div>
                <input id="fgPicker" class="color-input" type="color" value="#45ad7f">
              </div>
              <div class="mini-group" aria-hidden="false">
                <div class="mini-label">Nudge</div>
                <button id="fgLighter" class="mini-btn" title="Make foreground darker" aria-label="Make foreground darker">+</button>
                <button id="fgDarker" class="mini-btn" title="Make foreground lighter" aria-label="Make foreground lighter">âˆ’</button>
              </div>
              <div class="mini-group">
                <div class="mini-label">Random</div>
                <button id="randomFgDark" class="mini-btn" title="Random darker foreground" aria-label="Random darker foreground">Dark</button>
                <button id="randomFgLight" class="mini-btn" title="Random lighter foreground" aria-label="Random lighter foreground">Light</button>
              </div>
              <button id="saveFg" class="small-btn picker-save" title="Save foreground color">Save</button>
            </div>
          </label>
        </div>

        <div class="color-group">
          <h3>Background</h3>
          <label class="field">
            <span>Color value</span>
            <input id="bgText" class="text-input" type="text" value="hsl(159.43, 33.98%, 20.2%)" autocomplete="off">
          </label>
          <label class="field">
            <div class="picker-row">
              <div class="mini-group">
                <div class="mini-label">Picker</div>
                <input id="bgPicker" class="color-input" type="color" value="hsl(159.43, 33.98%, 20.2%)">
              </div>
              <div class="mini-group">
                <div class="mini-label">Nudge</div>
                <button id="bgLighter" class="mini-btn" title="Make background darker" aria-label="Make background darker">+</button>
                <button id="bgDarker" class="mini-btn" title="Make background lighter" aria-label="Make background lighter">âˆ’</button>
              </div>
              <div class="mini-group">
                <div class="mini-label">Random</div>
                <button id="randomBgDark" class="mini-btn" title="Random darker background" aria-label="Random darker background">Dark</button>
                <button id="randomBgLight" class="mini-btn" title="Random lighter background" aria-label="Random lighter background">Light</button>
              </div>
              <button id="saveBg" class="small-btn picker-save" title="Save background color">Save</button>
            </div>
          </label>
        </div>

        <div class="color-group">
          <h3>Focus color</h3>
          <label class="field checkbox-field">
            <input id="enableThird" type="checkbox">
            <span>Enable focus/hover color</span>
          </label>
          <div id="thirdContainer" class="third-container hidden">
            <label class="field">
              <span>Focus color value</span>
              <input id="thirdText" class="text-input" type="text"
                     value="rebeccapurple" autocomplete="off">
            </label>
            <label class="field">
              <div class="picker-row">
                <div class="mini-group">
                  <div class="mini-label">Picker</div>
                  <input id="thirdPicker" class="color-input" type="color" value="#663399">
                </div>
                <div class="mini-group">
                  <div class="mini-label">Nudge</div>
                  <button id="thirdLighter" class="mini-btn" title="Make focus color darker" aria-label="Make focus color darker">+</button>
                  <button id="thirdDarker" class="mini-btn" title="Make focus color lighter" aria-label="Make focus color lighter">âˆ’</button>
                </div>
                <div class="mini-group">
                  <div class="mini-label">Random</div>
                  <button id="randomThirdDark" class="mini-btn" title="Random darker focus color" aria-label="Random darker focus color">Dark</button>
                  <button id="randomThirdLight" class="mini-btn" title="Random lighter focus color" aria-label="Random lighter focus color">Light</button>
                </div>
                <button id="saveThird" class="small-btn picker-save" title="Save focus color">Save</button>
                <button id="findBestFocus" class="small-btn picker-find" title="Suggest focus color" aria-label="Suggest focus color">Suggestion</button>
              </div>
            </label>
            <div id="focusCandidates" class="focus-candidates small" aria-live="polite"></div>
          </div>
        </div>
      </div>

      <p id="colorExamples" class="small"><i>
        <b>Examples:</b> <code>pink</code>, <code>#0044cc</code>, <code>rgb(10 120 200)</code>,
        <code>hsl(200 40% 40%)</code>, <code>lch(60 50 240)</code> & <code>oklch(0.7 0.16 250)</code>
      </i></p>

      <div class="input-row thresholds-row" aria-label="Contrast thresholds">
        <div class="threshold-group">
          <h3>WCAG 2.x threshold</h3>
          <label>
            <span>Target ratio</span>
            <select id="wcagThreshold">
              <option value="4.5">4.5:1 (AA normal text)</option>
              <option value="3">3:1 (AA large text or UI)</option>
              <option value="7">7:1 (AAA)</option>
            </select>
          </label>
        </div>

        <div class="threshold-group">
          <h3>APCA threshold</h3>
          <label>
            <span>Target Lc</span>
            <select id="apcaThreshold">
              <option value="60">60 (body text)</option>
              <option value="45">45 (large text or UI)</option>
              <option value="75">75 (small text)</option>
              <option value="90">90 (very small text)</option>
            </select>
          </label>
        </div>
      </div>
    </section>

    <section class="panel" aria-labelledby="preview-heading">
      <h2 id="preview-heading">Preview</h2>

      <div class="preview-controls" aria-label="Color simulation options">
        <span class="small">View preview as:</span>
        <div class="sim-toggle-group" role="group" aria-label="Color vision simulation">
          <button type="button" class="sim-toggle btn-primary" data-sim="normal" aria-pressed="true">Normal</button>
          <button type="button" class="sim-toggle btn-secondary" data-sim="grayscale" aria-pressed="false">Grayscale</button>
          <button type="button" class="sim-toggle btn-secondary" data-sim="protanopia" aria-pressed="false">Protanopia</button>
          <button type="button" class="sim-toggle btn-secondary" data-sim="deuteranopia" aria-pressed="false">Deuteranopia</button>
          <button type="button" class="sim-toggle btn-secondary" data-sim="tritanopia" aria-pressed="false">Tritanopia</button>
        </div>
      </div>

      <p class="small">
        Both panels use your chosen colors for headings, body text, links, buttons, and simple icons.
        The right-hand panel shows a focus or hover state using the third color when enabled.
      </p>

      <div class="preview-grid">
        <div class="preview-card">
          <h3>Foreground on background</h3>
          <div id="previewBase" class="preview-box" aria-label="Preview of foreground on background">
            <h4 id="demoHeadingBase">Example heading</h4>
            <p>
              The quick brown fox jumps over the lazy dog. 1234567890.
              This paragraph uses the chosen foreground and background colors.
            </p>
            <p>
              <a id="demoLinkBase" href="#">Example link text</a>
            </p>
            
            <div class="button-variants">
              <button class="btn btn-text">Text</button>
              <button class="btn btn-ghost">Ghost</button>
              <button class="btn btn-filled">Filled</button>
              <button class="btn btn-raised">Raised</button>
            </div>
            <div id="barChartContainer" class="bar-chart" aria-hidden="true"></div>
            <div id="previewSavedIconsBase" class="preview-saved-icons" aria-hidden="false"></div>
          </div>
        </div>

        <div id="previewThirdCard" class="preview-card hidden">
          <h3>Focus states exposed</h3>
              <div id="previewThird" class="preview-box" aria-label="Preview of focus states on background">
                <h4 id="demoHeadingThird">Focus state example</h4>
            <p>
              This area shows how a focus or hover state could look against the
              background using your third color, contrasted with the main foreground.
            </p>
            <p>
              <a id="demoLinkThird" href="#">Focused link example</a>
            </p>
            <div class="button-variants">
              <button class="btn btn-text">Text</button>
              <button class="btn btn-ghost">Ghost</button>
              <button class="btn btn-filled">Filled</button>
              <button class="btn btn-raised">Raised</button>
            </div>
            <div id="barChartContainerThird" class="bar-chart" aria-hidden="true"></div>
              <div id="previewSavedIconsThird" class="preview-saved-icons" aria-hidden="false"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="panel" aria-labelledby="results-heading">
      <h2 id="results-heading">Results</h2>

      <div id="errorBox" class="error-box hidden" role="alert" aria-live="assertive"></div>

      <table class="results-table">
        <thead>
        <tr>
          <th scope="col">Pair</th>
          <th scope="col">Colors</th>
          <th scope="col">WCAG ratio</th>
          <th scope="col">WCAG status</th>
          <th scope="col">APCA Lc</th>
          <th scope="col">APCA status</th>
        </tr>
        </thead>
        <tbody id="resultsBody">
        <!-- Filled by JS -->
        </tbody>
      </table>

      <div id="focusSummary" class="focus-summary hidden">
        <h3>Focus appearance (WCAG&nbsp;2.2&nbsp;2.4.13)</h3>
        <p id="focusText"></p>
      </div>
    </section>

    <section id="suggestSection" class="panel hidden" aria-labelledby="suggest-heading">
      <h2 id="suggest-heading">Suggested colors that move toward both targets</h2>
      <p class="small">
        These suggestions adjust lightness (and, if needed, hue) to find nearby colors that
        always satisfy the chosen WCAG ratio and, where possible, also meet the APCA target while staying close to your chosen colors.
      </p>

      <div id="suggestionBox" class="suggestion-box">
        <div class="suggest-controls small">
          <label class="field checkbox-field">
            <input id="allowWcagOnly" type="checkbox">
            <span>Allow WCAG-only suggestions (ignore APCA target)</span>
          </label>
        </div>
        <div id="fgSuggestionBlock" class="suggest-block">
          <h3>Adjust foreground (keep background)</h3>
          <div id="fgSuggestions" class="swatches"></div>
          <p id="fgSuggestionStatus" class="small muted" aria-live="polite"></p>
        </div>
        <div id="bgSuggestionBlock" class="suggest-block">
          <h3>Adjust background (keep foreground)</h3>
          <div id="bgSuggestions" class="swatches"></div>
          <p id="bgSuggestionStatus" class="small muted" aria-live="polite"></p>
        </div>
        <div id="thirdSuggestionBlock" class="suggest-block hidden">
          <h3>Third or focus color on background</h3>
          <div id="thirdSuggestions" class="swatches"></div>
          <p id="thirdSuggestionStatus" class="small muted" aria-live="polite"></p>
        </div>
        <p class="small" id="suggestionStatus"></p>
      </div>
    </section>

    <section class="panel" aria-labelledby="harmony-heading">
      <h2 id="harmony-heading">Harmony Palette Generator</h2>
      <p class="small">Generate a 5-color harmonious palette based on the current foreground color. (No external API used.)</p>
      <div class="harmony-controls">
        <button id="harmonyButton" type="button">Generate Harmony Palette</button>
        <div id="harmonyNote" class="small muted">Harmony is generated by rotating hue and adjusting lightness/saturation from the foreground color to produce visually distinct but related swatches.</div>
      </div>
      <div id="harmonyOutput" class="harmony-grid" aria-live="polite"></div>
    </section>

    <section class="panel" aria-labelledby="saved-heading">
      <h2 id="saved-heading">Saved Color Palette (<span id="paletteCount">0</span>)</h2>
      <div id="paletteContainer" class="palette-list">
        <p id="palettePlaceholder" class="small italic">No saved colors yet. Use the Save buttons near color inputs.</p>
          <div class="palette-footer">
            <button id="clearPalette" type="button">Clear all</button>
            <button id="copyPalette" type="button">Copy palette</button>
          </div>
      </div>
    </section>

    <div id="liveRegion" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

    <footer class="page-footer">
      <p>
        WCAG 2.x contrast uses the standard luminance formula. APCA is loaded via a separate script;
        if it fails to load, APCA results show <code>n/a</code>. Color simulations are approximate
        and for visual exploration only.
      </p>
    </footer>
  </main>

  <svg aria-hidden="true" class="visually-hidden">
    <defs>
      <!-- Approximate color blindness simulation filters -->
      <filter id="sim-protanopia">
        <feColorMatrix type="matrix" values="
          0.567 0.433 0     0 0
          0.558 0.442 0     0 0
          0     0.242 0.758 0 0
          0     0     0     1 0" />
      </filter>
      <filter id="sim-deuteranopia">
        <feColorMatrix type="matrix" values="
          0.625 0.375 0     0 0
          0.7   0.3   0     0 0
          0     0.3   0.7   0 0
          0     0     0     1 0" />
      </filter>
      <filter id="sim-tritanopia">
        <feColorMatrix type="matrix" values="
          0.95  0.05  0     0 0
          0     0.433 0.567 0 0
          0     0.475 0.525 0 0
          0     0     0     1 0" />
      </filter>
    </defs>
  </svg>

<meta data-bsky-post-id="${post.bskyPostId}" />

<!-- Bluesky Footer -->
<section class="post__likes" data-bsky-container>
  <h3 class="post__likesTitle">
    ðŸ¦‹ <span data-bsky-likes-count></span> likes on Bluesky
  </h3>
  <a class="post__likesCta" href="https://bsky.app/profile/{handle}/post/${postId}" target="_blank">
	  Like this post on Bluesky to see your face on this page
  </a>
  <ul data-bsky-likes class="post__likesList"></ul>
</section>
  
  <script type="module" src="app.js"></script>
</body>
</html>
